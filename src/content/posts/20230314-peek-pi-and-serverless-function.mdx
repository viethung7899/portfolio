---
title: Peeking digits of Ï€ with serverless function
date: 2023-03-14
---

Happy $\pi$ day everybody! I'm going to show you how to use serverless functions to build an API for find digits in $$\pi$$.
It may not the most useful use case for the serverless functions, but it's a fun one. 
More importantly, you can see the API in action with an embedded $\pi$ finder in my blog below. 
Just type in any sequences in the form to find their positions among the first **one million** digits in $\pi$.

import PiPeek from "@interactives/pi/PiPeek.svelte"

<PiPeek client:only="svelte" />

## Why serveless function?

Some of you may think why don't let the client side do the calculation. 
Well, it could be a good idea, but that solution could not sccale well.
In order to that, we first need to load a file containing the $\pi$ digits into the client side.
It could work for a small number of digits like 1000 or 10000 digits because the file size is relatively small.
However, as the number of digits increases, the file size also increases. 
Letting our browswer to load such a large file and consume the memory space is not a good idea.

Another approach is to offload the work to the server side by writing a simple API to query the digits.
This approach is much better than the previous one, and more flexibile with scalability.
Hosting one simple API with on a separate server is maybe to much for a small project.
Since this site is deployed in Vercel, we can could levarage and implement our API with their [serverless functions](https://vercel.com/docs/concepts/functions/serverless-functions).

## How to implement the API

First, we need to create a folder called `api` in the root directory of our project. 
Our API endpoint will be `api/pi-peek/[number]`, where `[number]` is any query number.
So, we need to create a file called `pi-peek/[number].ts` in the `api` folder.
Also, we need to have a file contained the digits of $\pi$ and called `pi-million.txt` in the `api/pi-peek` folder.


```ts title="[number].ts"
import { NowRequest, NowResponse } from "@vercel/node";
import fs from "fs";
import path from "path";

// Load the digits of pi from the file
const pi = fs.readFileSync(path.join(__dirname, "pi-million.txt"), "utf8");

// The API endpoint
export default handler = (request: VercelRequest, response: VercelResponse) => {
  const number = request.query.number as string
  const index = pi.indexOf(number)
  const beforeIndex = index - 10
  const before = pi.slice(beforeIndex < 0 ? 0 : beforeIndex, index)
  const after = pi.slice(index + number.length, index + number.length + 10)
  response.status(200).send({
    index: index == 0 ? index : index - 1,
    before,
    middle: number,
    after
  })
}
```

